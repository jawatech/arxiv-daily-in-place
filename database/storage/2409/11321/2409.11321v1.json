{"2409.11321": {"publish_time": "2024-09-17", "title": "SOAP: Improving and Stabilizing Shampoo using Adam", "paper_summary": "There is growing evidence of the effectiveness of Shampoo, a higher-order\npreconditioning method, over Adam in deep learning optimization tasks. However,\nShampoo's drawbacks include additional hyperparameters and computational\noverhead when compared to Adam, which only updates running averages of first-\nand second-moment quantities. This work establishes a formal connection between\nShampoo (implemented with the 1/2 power) and Adafactor -- a memory-efficient\napproximation of Adam -- showing that Shampoo is equivalent to running\nAdafactor in the eigenbasis of Shampoo's preconditioner. This insight leads to\nthe design of a simpler and computationally efficient algorithm:\n$\\textbf{S}$hampo$\\textbf{O}$ with $\\textbf{A}$dam in the\n$\\textbf{P}$reconditioner's eigenbasis (SOAP).\n  With regards to improving Shampoo's computational efficiency, the most\nstraightforward approach would be to simply compute Shampoo's\neigendecomposition less frequently. Unfortunately, as our empirical results\nshow, this leads to performance degradation that worsens with this frequency.\nSOAP mitigates this degradation by continually updating the running average of\nthe second moment, just as Adam does, but in the current (slowly changing)\ncoordinate basis. Furthermore, since SOAP is equivalent to running Adam in a\nrotated space, it introduces only one additional hyperparameter (the\npreconditioning frequency) compared to Adam. We empirically evaluate SOAP on\nlanguage model pre-training with 360m and 660m sized models. In the large batch\nregime, SOAP reduces the number of iterations by over 40% and wall clock time\nby over 35% compared to AdamW, with approximately 20% improvements in both\nmetrics compared to Shampoo. An implementation of SOAP is available at\nhttps://github.com/nikhilvyas/SOAP.", "paper_summary_zh": "\u8d8a\u4f86\u8d8a\u591a\u7684\u8b49\u64da\u986f\u793a\uff0cShampoo \u662f\u4e00\u7a2e\u9ad8\u968e\u9810\u8655\u7406\u65b9\u6cd5\uff0c\u5728\u6df1\u5ea6\u5b78\u7fd2\u6700\u4f73\u5316\u4efb\u52d9\u4e2d\u512a\u65bc Adam\u3002\u7136\u800c\uff0c\u8207\u50c5\u66f4\u65b0\u4e00\u968e\u548c\u4e8c\u968e\u77e9\u5e73\u5747\u503c\u7684 Adam \u76f8\u6bd4\uff0cShampoo \u7684\u7f3a\u9ede\u5305\u62ec\u984d\u5916\u7684\u8d85\u53c3\u6578\u548c\u904b\u7b97\u8ca0\u64d4\u3002\u9019\u9805\u5de5\u4f5c\u5728 Shampoo\uff08\u4ee5 1/2 \u6b21\u65b9\u5be6\u4f5c\uff09\u548c Adafactor\uff08\u4e00\u7a2e\u8a18\u61b6\u9ad4\u6548\u7387\u4f73\u7684 Adam \u8fd1\u4f3c\u503c\uff09\u4e4b\u9593\u5efa\u7acb\u6b63\u5f0f\u7684\u95dc\u806f\uff0c\u986f\u793a Shampoo \u7b49\u65bc\u5728 Shampoo \u9810\u8655\u7406\u5668\u7684\u7279\u5fb5\u57fa\u5e95\u4e2d\u57f7\u884c Adafactor\u3002\u9019\u500b\u898b\u89e3\u5f15\u5c0e\u6211\u5011\u8a2d\u8a08\u4e00\u7a2e\u66f4\u7c21\u55ae\u4e14\u904b\u7b97\u6548\u7387\u66f4\u9ad8\u7684\u6f14\u7b97\u6cd5\uff1a$\\textbf{S}$hampo$\\textbf{O}$ with $\\textbf{A}$dam in the $\\textbf{P}$reconditioner's eigenbasis (SOAP)\u3002\n\u95dc\u65bc\u6539\u5584 Shampoo \u7684\u904b\u7b97\u6548\u7387\uff0c\u6700\u76f4\u63a5\u7684\u65b9\u6cd5\u5c31\u662f\u6e1b\u5c11\u8a08\u7b97 Shampoo \u7279\u5fb5\u5206\u89e3\u7684\u983b\u7387\u3002\u4e0d\u5e78\u7684\u662f\uff0c\u6b63\u5982\u6211\u5011\u7684\u5be6\u8b49\u7d50\u679c\u986f\u793a\uff0c\u9019\u6703\u5c0e\u81f4\u6548\u80fd\u964d\u4f4e\uff0c\u800c\u4e14\u983b\u7387\u8d8a\u9ad8\uff0c\u6548\u80fd\u5c31\u6703\u8d8a\u5dee\u3002SOAP \u900f\u904e\u6301\u7e8c\u66f4\u65b0\u4e8c\u968e\u77e9\u7684\u57f7\u884c\u5e73\u5747\u503c\u4f86\u6e1b\u8f15\u9019\u7a2e\u6548\u80fd\u964d\u4f4e\uff0c\u5c31\u50cf Adam \u6240\u505a\u7684\u4e00\u6a23\uff0c\u4f46\u4f7f\u7528\u7684\u662f\u76ee\u524d\u7684\uff08\u7de9\u6162\u8b8a\u5316\u7684\uff09\u5ea7\u6a19\u57fa\u5e95\u3002\u6b64\u5916\uff0c\u7531\u65bc SOAP \u7b49\u65bc\u5728\u65cb\u8f49\u7a7a\u9593\u4e2d\u57f7\u884c Adam\uff0c\u56e0\u6b64\u8207 Adam \u76f8\u6bd4\uff0c\u5b83\u53ea\u5f15\u5165\u4e00\u500b\u984d\u5916\u7684\u8d85\u53c3\u6578\uff08\u9810\u8655\u7406\u983b\u7387\uff09\u3002\u6211\u5011\u5be6\u8b49\u8a55\u4f30 SOAP \u5728\u8a9e\u8a00\u6a21\u578b\u9810\u8a13\u7df4\u4e2d\uff0c\u4f7f\u7528 360m \u548c 660m \u5927\u5c0f\u7684\u6a21\u578b\u3002\u5728\u5927\u6279\u6b21\u6a21\u5f0f\u4e2d\uff0c\u8207 AdamW \u76f8\u6bd4\uff0cSOAP \u5c07\u8fed\u4ee3\u6b21\u6578\u6e1b\u5c11\u8d85\u904e 40%\uff0c\u5c07\u5be6\u969b\u57f7\u884c\u6642\u9593\u6e1b\u5c11\u8d85\u904e 35%\uff0c\u8207 Shampoo \u76f8\u6bd4\uff0c\u5169\u9805\u6307\u6a19\u7686\u6539\u5584\u7d04 20%\u3002SOAP \u7684\u5be6\u4f5c\u53ef\u65bc https://github.com/nikhilvyas/SOAP \u53d6\u5f97\u3002", "author": "Nikhil Vyas et.al.", "authors": "Nikhil Vyas, Depen Morwani, Rosie Zhao, Itai Shapira, David Brandfonbrener, Lucas Janson, Sham Kakade", "id": "2409.11321v1", "paper_url": "http://arxiv.org/abs/2409.11321v1", "repo": "https://github.com/nikhilvyas/soap"}}