{"2412.13795": {"publish_time": "2024-12-18", "title": "Mix-LN: Unleashing the Power of Deeper Layers by Combining Pre-LN and Post-LN", "paper_summary": "Large Language Models (LLMs) have achieved remarkable success, yet recent\nfindings reveal that their deeper layers often contribute minimally and can be\npruned without affecting overall performance. While some view this as an\nopportunity for model compression, we identify it as a training shortfall\nrooted in the widespread use of Pre-Layer Normalization (Pre-LN). We\ndemonstrate that Pre-LN, commonly employed in models like GPT and LLaMA, leads\nto diminished gradient norms in its deeper layers, reducing their\neffectiveness. In contrast, Post-Layer Normalization (Post-LN) preserves larger\ngradient norms in deeper layers but suffers from vanishing gradients in earlier\nlayers. To address this, we introduce Mix-LN, a novel normalization technique\nthat combines the strengths of Pre-LN and Post-LN within the same model. Mix-LN\napplies Post-LN to the earlier layers and Pre-LN to the deeper layers, ensuring\nmore uniform gradients across layers. This allows all parts of the\nnetwork--both shallow and deep layers--to contribute effectively to training.\nExtensive experiments with various model sizes from 70M to 7B demonstrate that\nMix-LN consistently outperforms both Pre-LN and Post-LN, promoting more\nbalanced, healthier gradient norms throughout the network, and enhancing the\noverall quality of LLM pre-training. Furthermore, we demonstrate that models\npre-trained with Mix-LN learn better compared to those using Pre-LN or Post-LN\nduring supervised fine-tuning (SFT) and reinforcement learning from human\nfeedback (RLHF), highlighting the critical importance of high-quality deep\nlayers. By effectively addressing the inefficiencies of deep layers in current\nLLMs, Mix-LN unlocks their potential, enhancing model capacity without\nincreasing model size. Our code is available at\nhttps://github.com/pixeli99/MixLN.", "paper_summary_zh": "\u5927\u578b\u8a9e\u8a00\u6a21\u578b (LLM) \u5df2\u53d6\u5f97\u986f\u8457\u6210\u529f\uff0c\u4f46\u6700\u8fd1\u7684\u7814\u7a76\u767c\u73fe\uff0c\u5b83\u5011\u8f03\u6df1\u7684\u5c64\u7d1a\u901a\u5e38\u53ea\u505a\u51fa\u6975\u5c0f\u7684\u8ca2\u737b\uff0c\u800c\u4e14\u53ef\u4ee5\u4fee\u526a\u800c\u4e0d\u6703\u5f71\u97ff\u6574\u9ad4\u6548\u80fd\u3002\u96d6\u7136\u6709\u4e9b\u4eba\u5c07\u6b64\u8996\u70ba\u6a21\u578b\u58d3\u7e2e\u7684\u6a5f\u6703\uff0c\u4f46\u6211\u5011\u8a8d\u70ba\u9019\u662f\u8a13\u7df4\u4e0d\u8db3\uff0c\u6839\u6e90\u65bc\u5ee3\u6cdb\u4f7f\u7528\u9810\u5c64\u6a19\u6e96\u5316 (Pre-LN)\u3002\u6211\u5011\u8b49\u660e\u4e86\u9810\u5c64\u6a19\u6e96\u5316\uff08\u901a\u5e38\u7528\u65bc GPT \u548c LLaMA \u7b49\u6a21\u578b\uff09\u5c0e\u81f4\u5176\u8f03\u6df1\u5c64\u7d1a\u7684\u68af\u5ea6\u7bc4\u6578\u6e1b\u5c0f\uff0c\u964d\u4f4e\u4e86\u5b83\u5011\u7684\u6548\u80fd\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0c\u5f8c\u5c64\u6a19\u6e96\u5316 (Post-LN) \u5728\u8f03\u6df1\u5c64\u7d1a\u4fdd\u7559\u4e86\u8f03\u5927\u7684\u68af\u5ea6\u7bc4\u6578\uff0c\u4f46\u8f03\u65e9\u5c64\u7d1a\u7684\u68af\u5ea6\u6703\u6d88\u5931\u3002\u70ba\u4e86\u89e3\u6c7a\u9019\u500b\u554f\u984c\uff0c\u6211\u5011\u5f15\u5165\u4e86 Mix-LN\uff0c\u9019\u662f\u4e00\u7a2e\u65b0\u7a4e\u7684\u6a19\u6e96\u5316\u6280\u8853\uff0c\u7d50\u5408\u4e86\u9810\u5c64\u6a19\u6e96\u5316\u548c\u5f8c\u5c64\u6a19\u6e96\u5316\u7684\u512a\u9ede\u65bc\u540c\u4e00\u500b\u6a21\u578b\u4e2d\u3002Mix-LN \u5c07\u5f8c\u5c64\u6a19\u6e96\u5316\u61c9\u7528\u65bc\u8f03\u65e9\u5c64\u7d1a\uff0c\u5c07\u9810\u5c64\u6a19\u6e96\u5316\u61c9\u7528\u65bc\u8f03\u6df1\u5c64\u7d1a\uff0c\u78ba\u4fdd\u6240\u6709\u5c64\u7d1a\u7684\u68af\u5ea6\u66f4\u52a0\u5747\u52fb\u3002\u9019\u8b93\u7db2\u8def\u7684\u6240\u6709\u90e8\u5206\uff08\u6dfa\u5c64\u548c\u6df1\u5c64\uff09\u90fd\u80fd\u6709\u6548\u5730\u70ba\u8a13\u7df4\u505a\u51fa\u8ca2\u737b\u3002\u4f7f\u7528\u5f9e 70M \u5230 7B \u7684\u5404\u7a2e\u6a21\u578b\u898f\u6a21\u9032\u884c\u7684\u5927\u91cf\u5be6\u9a57\u8b49\u660e\uff0cMix-LN \u6301\u7e8c\u512a\u65bc\u9810\u5c64\u6a19\u6e96\u5316\u548c\u5f8c\u5c64\u6a19\u6e96\u5316\uff0c\u5728\u6574\u500b\u7db2\u8def\u4e2d\u4fc3\u9032\u4e86\u66f4\u5e73\u8861\u3001\u66f4\u5065\u5eb7\u7684\u68af\u5ea6\u7bc4\u6578\uff0c\u4e26\u63d0\u5347\u4e86 LLM \u9810\u8a13\u7df4\u7684\u6574\u9ad4\u54c1\u8cea\u3002\u6b64\u5916\uff0c\u6211\u5011\u8b49\u660e\u4e86\u4f7f\u7528 Mix-LN \u9810\u8a13\u7df4\u7684\u6a21\u578b\u5728\u76e3\u7763\u5fae\u8abf (SFT) \u548c\u4eba\u985e\u56de\u994b\u5f37\u5316\u5b78\u7fd2 (RLHF) \u671f\u9593\uff0c\u8207\u4f7f\u7528\u9810\u5c64\u6a19\u6e96\u5316\u6216\u5f8c\u5c64\u6a19\u6e96\u5316\u7684\u6a21\u578b\u76f8\u6bd4\uff0c\u5b78\u7fd2\u6548\u679c\u66f4\u597d\uff0c\u7a81\u986f\u4e86\u9ad8\u54c1\u8cea\u6df1\u5c64\u7d1a\u7684\u91cd\u8981\u6027\u3002\u900f\u904e\u6709\u6548\u89e3\u6c7a\u7576\u524d LLM \u4e2d\u6df1\u5c64\u7d1a\u7684\u4f4e\u6548\u7387\uff0cMix-LN \u91cb\u653e\u4e86\u5b83\u5011\u7684\u6f5b\u529b\uff0c\u5728\u4e0d\u589e\u52a0\u6a21\u578b\u898f\u6a21\u7684\u60c5\u6cc1\u4e0b\u63d0\u5347\u4e86\u6a21\u578b\u5bb9\u91cf\u3002\u6211\u5011\u7684\u7a0b\u5f0f\u78bc\u53ef\u5728 https://github.com/pixeli99/MixLN \u53d6\u5f97\u3002", "author": "Pengxiang Li et.al.", "authors": "Pengxiang Li, Lu Yin, Shiwei Liu", "id": "2412.13795v1", "paper_url": "http://arxiv.org/abs/2412.13795v1", "repo": "https://github.com/pixeli99/mixln"}}