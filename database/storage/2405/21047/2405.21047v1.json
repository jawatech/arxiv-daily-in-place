{"2405.21047": {"publish_time": "2024-05-31", "title": "Grammar-Aligned Decoding", "paper_summary": "Large Language Models (LLMs) struggle with reliably generating highly\nstructured outputs, such as program code, mathematical formulas, or well-formed\nmarkup. Constrained decoding approaches mitigate this problem by greedily\nrestricting what tokens an LLM can output at each step to guarantee that the\noutput matches a given constraint. Specifically, in grammar-constrained\ndecoding (GCD), the LLM's output must follow a given grammar. In this paper we\ndemonstrate that GCD techniques (and in general constrained decoding\ntechniques) can distort the LLM's distribution, leading to outputs that are\ngrammatical but appear with likelihoods that are not proportional to the ones\ngiven by the LLM, and so ultimately are low-quality. We call the problem of\naligning sampling with a grammar constraint, grammar-aligned decoding (GAD),\nand propose adaptive sampling with approximate expected futures (ASAp), a\ndecoding algorithm that guarantees the output to be grammatical while provably\nproducing outputs that match the conditional probability of the LLM's\ndistribution conditioned on the given grammar constraint. Our algorithm uses\nprior sample outputs to soundly overapproximate the future grammaticality of\ndifferent output prefixes. Our evaluation on code generation and structured NLP\ntasks shows how ASAp often produces outputs with higher likelihood (according\nto the LLM's distribution) than existing GCD techniques, while still enforcing\nthe desired grammatical constraints.", "paper_summary_zh": "\u5927\u578b\u8a9e\u8a00\u6a21\u578b (LLM) \u96e3\u4ee5\u53ef\u9760\u5730\u751f\u6210\u9ad8\u5ea6\u7d50\u69cb\u5316\u7684\u8f38\u51fa\uff0c\u4f8b\u5982\u7a0b\u5f0f\u78bc\u3001\u6578\u5b78\u516c\u5f0f\u6216\u683c\u5f0f\u826f\u597d\u7684\u6a19\u8a18\u3002\u53d7\u9650\u89e3\u78bc\u65b9\u6cd5\u900f\u904e\u8caa\u5a6a\u5730\u9650\u5236 LLM \u5728\u6bcf\u500b\u6b65\u9a5f\u4e2d\u53ef\u4ee5\u8f38\u51fa\u7684\u7b26\u865f\u4f86\u6e1b\u8f15\u6b64\u554f\u984c\uff0c\u4ee5\u78ba\u4fdd\u8f38\u51fa\u7b26\u5408\u7d66\u5b9a\u7684\u7d04\u675f\u3002\u5177\u9ad4\u4f86\u8aaa\uff0c\u5728\u8a9e\u6cd5\u7d04\u675f\u89e3\u78bc (GCD) \u4e2d\uff0cLLM \u7684\u8f38\u51fa\u5fc5\u9808\u9075\u5faa\u7d66\u5b9a\u7684\u8a9e\u6cd5\u3002\u5728\u672c\u6587\u4e2d\uff0c\u6211\u5011\u8b49\u660e GCD \u6280\u8853\uff08\u4ee5\u53ca\u4e00\u822c\u7684\u7d04\u675f\u89e3\u78bc\u6280\u8853\uff09\u6703\u626d\u66f2 LLM \u7684\u5206\u4f48\uff0c\u5c0e\u81f4\u8a9e\u6cd5\u6b63\u78ba\u4f46\u51fa\u73fe\u6a5f\u7387\u8207 LLM \u7d66\u51fa\u7684\u6a5f\u7387\u4e0d\u6210\u6bd4\u4f8b\u7684\u8f38\u51fa\uff0c\u56e0\u6b64\u6700\u7d42\u54c1\u8cea\u4e0d\u4f73\u3002\u6211\u5011\u5c07\u5c0d\u9f4a\u62bd\u6a23\u8207\u8a9e\u6cd5\u7d04\u675f\u7684\u554f\u984c\u7a31\u70ba\u8a9e\u6cd5\u5c0d\u9f4a\u89e3\u78bc (GAD)\uff0c\u4e26\u63d0\u51fa\u5177\u6709\u8fd1\u4f3c\u9810\u671f\u672a\u4f86\u7684\u81ea\u9069\u61c9\u62bd\u6a23 (ASAp)\uff0c\u9019\u662f\u4e00\u7a2e\u89e3\u78bc\u6f14\u7b97\u6cd5\uff0c\u53ef\u4fdd\u8b49\u8f38\u51fa\u8a9e\u6cd5\u6b63\u78ba\uff0c\u540c\u6642\u53ef\u8b49\u660e\u7522\u751f\u8207 LLM \u5206\u4f48\u689d\u4ef6\u6a5f\u7387\u76f8\u7b26\u7684\u8f38\u51fa\uff0c\u689d\u4ef6\u70ba\u7d66\u5b9a\u7684\u8a9e\u6cd5\u7d04\u675f\u3002\u6211\u5011\u7684\u6f14\u7b97\u6cd5\u4f7f\u7528\u5148\u524d\u7684\u6a23\u672c\u8f38\u51fa\uff0c\u4ee5\u5065\u5168\u5730\u904e\u5ea6\u8fd1\u4f3c\u4e0d\u540c\u8f38\u51fa\u524d\u7db4\u7684\u672a\u4f86\u8a9e\u6cd5\u6027\u3002\u6211\u5011\u5c0d\u7a0b\u5f0f\u78bc\u751f\u6210\u548c\u7d50\u69cb\u5316 NLP \u4efb\u52d9\u7684\u8a55\u4f30\u986f\u793a\uff0c\u8207\u73fe\u6709\u7684 GCD \u6280\u8853\u76f8\u6bd4\uff0cASAp \u901a\u5e38\u6703\u7522\u751f\u5177\u6709\u66f4\u9ad8\u6a5f\u7387\uff08\u6839\u64da LLM \u7684\u5206\u4f48\uff09\u7684\u8f38\u51fa\uff0c\u540c\u6642\u4ecd\u5f37\u5236\u57f7\u884c\u6240\u9700\u7684\u8a9e\u6cd5\u7d04\u675f\u3002", "author": "Kanghee Park et.al.", "authors": "Kanghee Park, Jiayu Wang, Taylor Berg-Kirkpatrick, Nadia Polikarpova, Loris D'Antoni", "id": "2405.21047v1", "paper_url": "http://arxiv.org/abs/2405.21047v1", "repo": "null"}}