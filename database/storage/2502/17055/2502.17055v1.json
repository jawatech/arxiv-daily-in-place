{"2502.17055": {"publish_time": "2025-02-24", "title": "Stable-SPAM: How to Train in 4-Bit More Stably than 16-Bit Adam", "paper_summary": "This paper comprehensively evaluates several recently proposed optimizers for\n4-bit training, revealing that low-bit precision amplifies sensitivity to\nlearning rates and often causes unstable gradient norms, leading to divergence\nat higher learning rates. Among these, SPAM, a recent optimizer featuring\nmomentum reset and spike-aware gradient clipping, achieves the best performance\nacross various bit levels, but struggles to stabilize gradient norms, requiring\ncareful learning rate tuning. To address these limitations, we propose\nStable-SPAM, which incorporates enhanced gradient normalization and clipping\ntechniques. In particular, Stable-SPAM (1) adaptively updates the clipping\nthreshold for spiked gradients by tracking their historical maxima; (2)\nnormalizes the entire gradient matrix based on its historical $l_2$-norm\nstatistics; and $(3)$ inherits momentum reset from SPAM to periodically reset\nthe first and second moments of Adam, mitigating the accumulation of spiked\ngradients. Extensive experiments show that Stable-SPAM effectively stabilizes\ngradient norms in 4-bit LLM training, delivering superior performance compared\nto Adam and SPAM. Notably, our 4-bit LLaMA-1B model trained with Stable-SPAM\noutperforms the BF16 LLaMA-1B trained with Adam by up to $2$ perplexity.\nFurthermore, when both models are trained in 4-bit, Stable-SPAM achieves the\nsame loss as Adam while requiring only about half the training steps. Code is\navailable at https://github.com/TianjinYellow/StableSPAM.git.", "paper_summary_zh": "<paragraph>\u672c\u6587\u5168\u9762\u8a55\u4f30\u4e86\u8fd1\u671f\u63d0\u51fa\u7684\u6578\u500b 4 \u4f4d\u5143\u8a13\u7df4\u6700\u4f73\u5316\u5668\uff0c\u63ed\u793a\u4f4e\u4f4d\u5143\u7cbe\u78ba\u5ea6\u6703\u653e\u5927\u5c0d\u5b78\u7fd2\u7387\u7684\u654f\u611f\u5ea6\uff0c\u4e14\u7d93\u5e38\u5c0e\u81f4\u4e0d\u7a69\u5b9a\u7684\u68af\u5ea6\u7bc4\u6578\uff0c\u9020\u6210\u8f03\u9ad8\u5b78\u7fd2\u7387\u6642\u7684\u767c\u6563\u3002\u5176\u4e2d\uff0cSPAM \u662f\u4e00\u7a2e\u8fd1\u671f\u6700\u4f73\u5316\u5668\uff0c\u5177\u5099\u52d5\u80fd\u91cd\u8a2d\u548c\u5c16\u5cf0\u611f\u77e5\u68af\u5ea6\u88c1\u526a\uff0c\u5728\u5404\u7a2e\u4f4d\u5143\u5c64\u7d1a\u4e2d\u9054\u6210\u6700\u4f73\u6548\u80fd\uff0c\u4f46\u96e3\u4ee5\u7a69\u5b9a\u68af\u5ea6\u7bc4\u6578\uff0c\u9700\u8981\u5c0f\u5fc3\u8abf\u6574\u5b78\u7fd2\u7387\u3002\u70ba\u4e86\u89e3\u6c7a\u9019\u4e9b\u9650\u5236\uff0c\u6211\u5011\u63d0\u51fa Stable-SPAM\uff0c\u5b83\u7d50\u5408\u4e86\u589e\u5f37\u7684\u68af\u5ea6\u6b63\u898f\u5316\u548c\u88c1\u526a\u6280\u8853\u3002\u7279\u5225\u662f\uff0cStable-SPAM (1) \u900f\u904e\u8ffd\u8e64\u5c16\u5cf0\u68af\u5ea6\u7684\u6b77\u53f2\u6700\u5927\u503c\uff0c\u81ea\u9069\u61c9\u5730\u66f4\u65b0\u88c1\u526a\u95be\u503c\uff1b(2) \u6839\u64da\u5176\u6b77\u53f2 $l_2$-norm \u7d71\u8a08\u8cc7\u6599\u6b63\u898f\u5316\u6574\u500b\u68af\u5ea6\u77e9\u9663\uff1b\u4ee5\u53ca (3) \u5f9e SPAM \u7e7c\u627f\u52d5\u80fd\u91cd\u8a2d\uff0c\u5b9a\u671f\u91cd\u8a2d Adam \u7684\u4e00\u968e\u548c\u4e8c\u968e\u52d5\u80fd\uff0c\u5f9e\u800c\u6e1b\u8f15\u5c16\u5cf0\u68af\u5ea6\u7684\u7d2f\u7a4d\u3002\u5ee3\u6cdb\u7684\u5be6\u9a57\u986f\u793a\uff0cStable-SPAM \u5728 4 \u4f4d\u5143 LLM \u8a13\u7df4\u4e2d\u6709\u6548\u5730\u7a69\u5b9a\u68af\u5ea6\u7bc4\u6578\uff0c\u8207 Adam \u548c SPAM \u76f8\u6bd4\uff0c\u80fd\u63d0\u4f9b\u66f4\u512a\u7570\u7684\u6548\u80fd\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u6211\u5011\u4f7f\u7528 Stable-SPAM \u8a13\u7df4\u7684 4 \u4f4d\u5143 LLaMA-1B \u6a21\u578b\uff0c\u6bd4\u4f7f\u7528 Adam \u8a13\u7df4\u7684 BF16 LLaMA-1B \u6e1b\u5c11\u4e86\u591a\u9054 $2$ \u500b\u56f0\u60d1\u5ea6\u3002\u6b64\u5916\uff0c\u7576\u5169\u500b\u6a21\u578b\u90fd\u4ee5 4 \u4f4d\u5143\u8a13\u7df4\u6642\uff0cStable-SPAM \u9054\u5230\u8207 Adam \u76f8\u540c\u7684\u640d\u5931\uff0c\u540c\u6642\u50c5\u9700\u8981\u7d04\u4e00\u534a\u7684\u8a13\u7df4\u6b65\u9a5f\u3002\u7a0b\u5f0f\u78bc\u53ef\u65bc https://github.com/TianjinYellow/StableSPAM.git \u53d6\u5f97\u3002</paragraph>", "author": "Tianjin Huang et.al.", "authors": "Tianjin Huang, Haotian Hu, Zhenyu Zhang, Gaojie Jin, Xiang Li, Li Shen, Tianlong Chen, Lu Liu, Qingsong Wen, Zhangyang Wang, Shiwei Liu", "id": "2502.17055v1", "paper_url": "http://arxiv.org/abs/2502.17055v1", "repo": "null"}}