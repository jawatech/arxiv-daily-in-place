{"2407.03157": {"publish_time": "2024-07-03", "title": "Let the Code LLM Edit Itself When You Edit the Code", "paper_summary": "In this work, we investigate a typical scenario in code generation where a\ndeveloper edits existing code in real time and requests a code assistant, e.g.,\na large language model, to re-predict the next token or next line on the fly.\nNaively, the LLM needs to re-encode the entire KV cache to provide an accurate\nprediction. However, this process is computationally expensive, especially when\nthe sequence length is long. Simply encoding the edited subsequence and\nintegrating it to the original KV cache meets the temporal confusion problem,\nleading to significantly worse performance. We address this efficiency and\naccuracy trade-off by introducing \\underline{\\textbf{Positional\n\\textbf{I}ntegrity \\textbf{E}ncoding} (PIE). Building upon the rotary\npositional encoding, PIE first removes the rotary matrices in the Key cache\nthat introduce temporal confusion and then reapplies the correct rotary\nmatrices. This process ensures that positional relationships between tokens are\ncorrect and requires only a single round of matrix multiplication. We validate\nthe effectiveness of PIE through extensive experiments on the RepoBench-C-8k\ndataset, utilizing DeepSeek-Coder models with 1.3B, 6.7B, and 33B parameters.\nOur evaluation includes three real-world coding tasks: code insertion, code\ndeletion, and multi-place code editing. Results demonstrate that PIE reduces\ncomputational overhead by over 85% compared to the standard full recomputation\napproach across all model sizes and tasks while well approximating the model\nperformance.", "paper_summary_zh": "\u5728\u9019\u9805\u5de5\u4f5c\u4e2d\uff0c\u6211\u5011\u8abf\u67e5\u7a0b\u5f0f\u78bc\u7522\u751f\u4e2d\u4e00\u500b\u5178\u578b\u7684\u5834\u666f\uff0c\u5176\u4e2d\u958b\u767c\u4eba\u54e1\u5373\u6642\u7de8\u8f2f\u73fe\u6709\u7a0b\u5f0f\u78bc\u4e26\u8981\u6c42\u7a0b\u5f0f\u78bc\u52a9\u7406\uff08\u4f8b\u5982\u5927\u578b\u8a9e\u8a00\u6a21\u578b\uff09\u5373\u6642\u91cd\u65b0\u9810\u6e2c\u4e0b\u4e00\u500b\u7b26\u865f\u6216\u4e0b\u4e00\u884c\u3002\u5929\u771f\u5730\u8aaa\uff0cLLM \u9700\u8981\u91cd\u65b0\u7de8\u78bc\u6574\u500b KV \u5feb\u53d6\u624d\u80fd\u63d0\u4f9b\u6e96\u78ba\u7684\u9810\u6e2c\u3002\u7136\u800c\uff0c\u9019\u500b\u904e\u7a0b\u5728\u8a08\u7b97\u4e0a\u5f88\u6602\u8cb4\uff0c\u5c24\u5176\u7576\u5e8f\u5217\u9577\u5ea6\u5f88\u9577\u6642\u3002\u50c5\u7de8\u78bc\u5df2\u7de8\u8f2f\u7684\u5b50\u5e8f\u5217\u4e26\u5c07\u5176\u6574\u5408\u5230\u539f\u59cb KV \u5feb\u53d6\u4e2d\u6703\u9047\u5230\u6642\u9593\u6df7\u6dc6\u554f\u984c\uff0c\u5c0e\u81f4\u6548\u80fd\u986f\u8457\u4e0b\u964d\u3002\u6211\u5011\u900f\u904e\u5f15\u5165\\underline{\\textbf{\u4f4d\u7f6e\u5b8c\u6574\u6027\u7de8\u78bc} (PIE)}\u4f86\u89e3\u6c7a\u9019\u500b\u6548\u7387\u548c\u6e96\u78ba\u6027\u7684\u6b0a\u8861\u3002\u5efa\u7acb\u5728\u65cb\u8f49\u4f4d\u7f6e\u7de8\u78bc\u7684\u57fa\u790e\u4e0a\uff0cPIE \u9996\u5148\u79fb\u9664 Key \u5feb\u53d6\u4e2d\u5f15\u5165\u6642\u9593\u6df7\u6dc6\u7684\u65cb\u8f49\u77e9\u9663\uff0c\u7136\u5f8c\u91cd\u65b0\u5957\u7528\u6b63\u78ba\u7684\u65cb\u8f49\u77e9\u9663\u3002\u9019\u500b\u904e\u7a0b\u78ba\u4fdd\u7b26\u865f\u4e4b\u9593\u7684\u4f4d\u7f6e\u95dc\u4fc2\u6b63\u78ba\uff0c\u4e26\u4e14\u53ea\u9700\u8981\u4e00\u8f2a\u77e9\u9663\u4e58\u6cd5\u3002\u6211\u5011\u900f\u904e\u5728 RepoBench-C-8k \u8cc7\u6599\u96c6\u4e0a\u9032\u884c\u5ee3\u6cdb\u7684\u5be6\u9a57\uff0c\u5229\u7528\u5177\u6709 1.3B\u30016.7B \u548c 33B \u53c3\u6578\u7684 DeepSeek-Coder \u6a21\u578b\u9a57\u8b49 PIE \u7684\u6709\u6548\u6027\u3002\u6211\u5011\u7684\u8a55\u4f30\u5305\u62ec\u4e09\u500b\u771f\u5be6\u4e16\u754c\u7684\u7de8\u78bc\u4efb\u52d9\uff1a\u7a0b\u5f0f\u78bc\u63d2\u5165\u3001\u7a0b\u5f0f\u78bc\u522a\u9664\u548c\u591a\u8655\u7a0b\u5f0f\u78bc\u7de8\u8f2f\u3002\u7d50\u679c\u8868\u660e\uff0c\u8207\u6240\u6709\u6a21\u578b\u5927\u5c0f\u548c\u4efb\u52d9\u7684\u6a19\u6e96\u5b8c\u5168\u91cd\u65b0\u8a08\u7b97\u65b9\u6cd5\u76f8\u6bd4\uff0cPIE \u5c07\u8a08\u7b97\u958b\u92b7\u6e1b\u5c11\u4e86 85% \u4ee5\u4e0a\uff0c\u540c\u6642\u5f88\u597d\u5730\u903c\u8fd1\u6a21\u578b\u6548\u80fd\u3002", "author": "Zhenyu He et.al.", "authors": "Zhenyu He, Jun Zhang, Shengjie Luo, Jingjing Xu, Zhi Zhang, Di He", "id": "2407.03157v1", "paper_url": "http://arxiv.org/abs/2407.03157v1", "repo": "null"}}